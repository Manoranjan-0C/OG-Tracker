<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>OG Tracker Pro</title>
    
    <!-- GLOBAL ERROR CATCHER -->
    <script>
        function showErrorOnScreen(title, message) {
            document.body.innerHTML = `
                <div style="background-color:#0f172a; color:#f87171; padding:30px; font-family:sans-serif; height:100vh; display:flex; flex-direction:column; justify-content:center;">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-bottom:20px;">
                        <circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <h1 style="font-size:24px; font-weight:900; margin-bottom:10px; color:#ef4444;">${title}</h1>
                    <p style="font-weight:bold; font-size:16px; line-height:1.5;">${message}</p>
                </div>
            `;
        }
        window.addEventListener('error', function(e) { showErrorOnScreen("APP CRASHED", e.message || "Unknown Script Error"); });
        window.addEventListener('unhandledrejection', function(e) { showErrorOnScreen("NETWORK ERROR", e.reason ? e.reason.message || e.reason : "Network request failed."); });
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { fontFamily: { sans: ['Outfit', 'sans-serif'] } } } }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    
    <!-- React & Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.6/babel.min.js"></script>
    
    <!-- Lucide Icons (Switched to unpkg for better mobile compatibility) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- FIREBASE COMPAT LIBRARIES -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.min.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; background-color: #0f172a; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass-panel { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); }
    </style>
</head>
<body class="antialiased transition-colors duration-500 selection:bg-indigo-500/30">
    <div id="root"></div>

    <script type="text/babel">
        // 1. FRAMEWORK CHECK
        if (!window.React) throw new Error("React Framework failed to load. Check your internet connection.");
        if (!window.firebase) throw new Error("Firebase failed to load. Check your internet connection.");

        const { useState, useEffect } = React;

        // 2. ICON FAIL-SAFE (Prevents crash if icons are blocked)
        const L = window.lucide || {};
        const FallbackIcon = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/></svg>
        );
        
        const Flame = L.Flame || FallbackIcon;
        const Dumbbell = L.Dumbbell || FallbackIcon;
        const Calendar = L.Calendar || FallbackIcon;
        const Menu = L.Menu || FallbackIcon;
        const X = L.X || FallbackIcon;
        const Check = L.Check || FallbackIcon;
        const Timer = L.Timer || FallbackIcon;
        const Sun = L.Sun || FallbackIcon;
        const Moon = L.Moon || FallbackIcon;
        const ChevronLeft = L.ChevronLeft || FallbackIcon;
        const ChevronRight = L.ChevronRight || FallbackIcon;
        const Activity = L.Activity || FallbackIcon;
        const Zap = L.Zap || FallbackIcon;
        const Star = L.Star || FallbackIcon;
        const LogOut = L.LogOut || FallbackIcon;
        const Mail = L.Mail || FallbackIcon;
        const Lock = L.Lock || FallbackIcon;
        const AlertTriangle = L.AlertTriangle || FallbackIcon;

        // =========================================================================
        // YOUR FIREBASE CONFIG
        // =========================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDgmejHd4qVbUO_anDPAWXMIyCKQZZ0OlU",
            authDomain: "og-tracker-3c239.firebaseapp.com",
            projectId: "og-tracker-3c239",
            storageBucket: "og-tracker-3c239.firebasestorage.app",
            messagingSenderId: "709565564880",
            appId: "1:709565564880:web:19c2ffa51e89bfbb209bd5",
            measurementId: "G-TKK9MYZDF1"
        };

        let auth, db, firebaseEnabled = false;

        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            firebaseEnabled = true;
        } catch (error) {
            throw new Error("Firebase Initialization Error: " + error.message);
        }

        // --- EXERCISE DATA ---
        const DEFAULT_ROUTINE = [
            { id: 'w1', category: 'warmup', name: "Jumping Jacks", reps: "50", sets: 2, type: "reps" },
            { id: 'w2', category: 'warmup', name: "High Knees", reps: "50", sets: 2, type: "reps" },
            { id: 'm1', category: 'main', name: "Push-ups", reps: "15", sets: 3, type: "reps" },
            { id: 'm2', category: 'main', name: "Squats", reps: "20", sets: 3, type: "reps" },
            { id: 'm3', category: 'main', name: "Lunges", reps: "14", sets: 3, type: "reps" },
            { id: 'm4', category: 'main', name: "Plank", reps: "60", sets: 3, type: "timer" },
            { id: 's1', category: 'stretching', name: "Cobra Stretch", reps: "30", sets: 1, type: "timer" }
        ];

        const CATEGORY_STYLES = {
            warmup: { title: "Warm Up", icon: Zap, bg: "bg-amber-500/10", text: "text-amber-500", active: "bg-gradient-to-br from-amber-400 to-orange-500 text-white" },
            main: { title: "Main Routine", icon: Dumbbell, bg: "bg-indigo-500/10", text: "text-indigo-500", active: "bg-gradient-to-br from-indigo-500 to-purple-600 text-white" },
            stretching: { title: "Cool Down", icon: Activity, bg: "bg-emerald-500/10", text: "text-emerald-500", active: "bg-gradient-to-br from-emerald-400 to-teal-500 text-white" }
        };

        // --- AUTH SCREEN ---
        const AuthScreen = ({ isDark }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError(""); setLoading(true);
                try {
                    if (isLogin) {
                        await auth.signInWithEmailAndPassword(email, password);
                    } else {
                        await auth.createUserWithEmailAndPassword(email, password);
                    }
                } catch (err) {
                    if (err.code === 'auth/unauthorized-domain') {
                        setError(`VERCEL BLOCK: You MUST add "${window.location.hostname}" to Firebase Console -> Authentication -> Settings -> Authorized Domains.`);
                    } else if (err.code === 'auth/operation-not-allowed') {
                        setError("FIREBASE SETUP ERROR: You must turn on 'Email/Password' in the Firebase Console (Authentication > Sign-in method tab).");
                    } else {
                        setError(err.message.replace("Firebase: ", ""));
                    }
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className={`min-h-screen flex items-center justify-center p-6 ${isDark ? 'bg-[#0f172a] text-white' : 'bg-slate-50 text-slate-900'}`}>
                    <div className="w-full max-w-sm">
                        <div className="text-center mb-10">
                            <div className="inline-block bg-gradient-to-br from-indigo-500 to-purple-600 p-4 rounded-[2rem] text-white mb-6"><Star size={40} fill="currentColor" /></div>
                            <h1 className="text-4xl font-black uppercase italic tracking-tighter">OG Tracker</h1>
                            <p className="mt-2 text-[10px] font-bold uppercase tracking-widest opacity-50">App Securely Connected</p>
                        </div>
                        <form onSubmit={handleSubmit} className={`p-8 rounded-[2.5rem] border shadow-2xl ${isDark ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>
                            <h2 className="text-2xl font-black mb-6">{isLogin ? 'Welcome Back' : 'Create Account'}</h2>
                            
                            {error && <div className="mb-6 p-4 rounded-2xl bg-rose-500/10 border border-rose-500/20 text-rose-500 text-xs font-bold leading-relaxed">{error}</div>}
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="text-[10px] font-black uppercase text-slate-400 mb-2 block">Email</label>
                                    <div className={`flex items-center gap-3 p-4 rounded-2xl border ${isDark ? 'bg-slate-950 border-slate-800' : 'bg-slate-50 border-slate-200'}`}>
                                        <Mail size={18} className="text-slate-400" />
                                        <input type="email" value={email} onChange={e => setEmail(e.target.value)} required className="w-full bg-transparent font-bold outline-none" />
                                    </div>
                                </div>
                                <div>
                                    <label className="text-[10px] font-black uppercase text-slate-400 mb-2 block">Password</label>
                                    <div className={`flex items-center gap-3 p-4 rounded-2xl border ${isDark ? 'bg-slate-950 border-slate-800' : 'bg-slate-50 border-slate-200'}`}>
                                        <Lock size={18} className="text-slate-400" />
                                        <input type="password" value={password} onChange={e => setPassword(e.target.value)} required className="w-full bg-transparent font-bold outline-none" />
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" disabled={loading} className="w-full mt-8 py-4 rounded-2xl bg-indigo-600 text-white font-black shadow-lg disabled:opacity-50 active:scale-95 transition-transform">
                                {loading ? 'Processing...' : (isLogin ? 'LOGIN' : 'SIGN UP')}
                            </button>
                            <button type="button" onClick={() => { setIsLogin(!isLogin); setError(""); }} className="w-full mt-6 text-xs font-bold text-slate-400 uppercase tracking-widest hover:text-indigo-400">
                                {isLogin ? "Need an account? Sign up" : "Already have an account? Log in"}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            const [isDark, setIsDark] = useState(true);
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [user, setUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);
            const [logs, setLogs] = useState({});

            useEffect(() => {
                if (isDark) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [isDark]);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(u => { setUser(u); setAuthLoading(false); });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                let unsubLogs = () => {};
                if (user) {
                    const logsRef = db.collection("artifacts").doc("og-tracker").collection("users").doc(user.uid).collection("logs").doc(selectedDate);
                    unsubLogs = logsRef.onSnapshot(snap => setLogs(snap.exists ? snap.data() : {}));
                }
                return () => unsubLogs();
            }, [selectedDate, user]);

            const toggleSet = async (exId, setIdx) => {
                const exLogs = logs[exId] || [];
                const newExLogs = [...exLogs];
                newExLogs[setIdx] = !newExLogs[setIdx];
                const newLogs = { ...logs, [exId]: newExLogs };
                
                setLogs(newLogs); 

                if (user) {
                    const logsRef = db.collection("artifacts").doc("og-tracker").collection("users").doc(user.uid).collection("logs").doc(selectedDate);
                    await logsRef.set(newLogs, { merge: true });
                }
            };

            const changeDate = (days) => {
                const d = new Date(selectedDate); d.setDate(d.getDate() + days);
                setSelectedDate(d.toISOString().split('T')[0]);
            };

            const isToday = selectedDate === new Date().toISOString().split('T')[0];

            if (authLoading) return <div className={`min-h-screen flex items-center justify-center ${isDark ? 'bg-[#0f172a]' : 'bg-slate-50'}`}><div className="w-10 h-10 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div></div>;
            
            if (!user) return <AuthScreen isDark={isDark} />;

            return (
                <div className={`min-h-screen ${isDark ? 'bg-[#0f172a] text-white' : 'bg-slate-50 text-slate-900'} pb-28`}>
                    <nav className={`fixed top-0 left-0 right-0 z-50 glass-panel border-b ${isDark ? 'bg-[#0f172a]/80 border-slate-800' : 'bg-white/80 border-slate-200'} px-5 py-4 flex justify-between items-center`}>
                        <div className="flex items-center gap-2">
                            <div className="bg-gradient-to-br from-indigo-500 to-purple-600 p-1.5 rounded-xl text-white"><Star size={20} fill="currentColor" /></div>
                            <h1 className="font-black text-xl tracking-tighter uppercase italic">OG Tracker</h1>
                        </div>
                        <div className="flex items-center gap-2">
                            <button onClick={() => auth.signOut()} className="p-2.5 rounded-full bg-slate-800 text-rose-400"><LogOut size={18} /></button>
                            <button onClick={() => setIsDark(!isDark)} className="p-2.5 rounded-full bg-slate-800 text-yellow-400"><Sun size={18} /></button>
                        </div>
                    </nav>

                    <main className="max-w-md mx-auto px-4 pt-24 pb-10">
                        <div className={`mb-8 p-6 rounded-[2rem] shadow-2xl relative overflow-hidden ${isToday ? 'bg-indigo-600 text-white' : (isDark ? 'bg-slate-800 text-white' : 'bg-white border-2 border-slate-200 text-slate-900')}`}>
                            <div className="relative z-10 flex justify-between items-center">
                                <div>
                                    <p className={`text-[10px] font-black uppercase tracking-widest mb-1 ${isToday ? 'text-indigo-200' : 'text-slate-400'}`}>Target Date</p>
                                    <h2 className="text-3xl font-black tracking-tight">{isToday ? 'TODAY' : selectedDate}</h2>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => changeDate(-1)} className={`p-3 rounded-2xl ${isToday ? 'bg-white/20' : (isDark ? 'bg-slate-700' : 'bg-slate-100')}`}><ChevronLeft size={20} /></button>
                                    <button onClick={() => changeDate(1)} className={`p-3 rounded-2xl ${isToday ? 'bg-white/20' : (isDark ? 'bg-slate-700' : 'bg-slate-100')}`}><ChevronRight size={20} /></button>
                                </div>
                            </div>
                        </div>

                        {['warmup', 'main', 'stretching'].map(cat => {
                            const exercises = DEFAULT_ROUTINE.filter(e => e.category === cat);
                            const style = CATEGORY_STYLES[cat];
                            const Icon = style.icon;

                            return (
                                <div key={cat} className="mb-8">
                                    <div className="flex items-center gap-3 mb-4 px-2">
                                        <div className={`p-2 rounded-xl ${style.bg} ${style.text}`}><Icon size={20} strokeWidth={2.5} /></div>
                                        <h3 className={`font-black text-xl tracking-tight uppercase ${isDark ? 'text-white' : 'text-slate-900'}`}>{style.title}</h3>
                                    </div>
                                    <div className="space-y-3">
                                        {exercises.map(ex => {
                                            const exLogs = logs[ex.id] || [];
                                            return (
                                                <div key={ex.id} className={`p-5 rounded-3xl border-2 ${isDark ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-100'}`}>
                                                    <div className="flex justify-between items-center mb-4">
                                                        <div>
                                                            <h4 className="font-bold text-lg leading-none mb-1">{ex.name}</h4>
                                                            <p className="text-xs font-bold uppercase text-slate-400">{ex.reps} {ex.type === 'timer' ? 'Secs' : 'Reps'}</p>
                                                        </div>
                                                    </div>
                                                    <div className="flex flex-wrap gap-2">
                                                        {[...Array(parseInt(ex.sets))].map((_, i) => (
                                                            <button key={i} onClick={() => toggleSet(ex.id, i)} className={`flex-1 min-w-[60px] h-12 rounded-2xl border-2 font-black text-xs flex justify-center items-center transition-all active:scale-90 ${exLogs[i] ? style.active : (isDark ? 'bg-slate-800 border-slate-700 text-slate-400' : 'bg-slate-50 border-slate-200 text-slate-500')}`}>
                                                                {exLogs[i] ? <Check strokeWidth={4} size={16} /> : `SET ${i + 1}`}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


