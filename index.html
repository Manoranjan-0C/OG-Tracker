<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>OG Tracker Pro</title>
    
    <script>
        window.addEventListener('error', function(e) {
            document.body.innerHTML = '<div style="background:#0f172a; color:#f87171; padding:30px; height:100vh;"><h1>APP CRASHED</h1><p>' + e.message + '</p></div>';
        });
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.6/babel.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; background-color: #0f172a; font-family: sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass-panel { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); }
    </style>
</head>
<body class="antialiased transition-colors duration-500 selection:bg-indigo-500/30">
    <div id="root"></div>

    <script type="text/babel">
        if (!window.React || !window.firebase) {
            throw new Error("React or Firebase failed to load from Google's servers. Please check your network or try switching between WiFi/Mobile Data.");
        }

        const { useState, useEffect } = React;

        // --- HARDCODED ICONS (No external library to fail!) ---
        const IconStar = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>;
        const IconMail = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>;
        const IconLock = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>;
        const IconLogOut = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>;
        const IconSun = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>;
        const IconMoon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>;
        const IconChevronLeft = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="15 18 9 12 15 6"></polyline></svg>;
        const IconChevronRight = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"></polyline></svg>;
        const IconCheck = ({size=16}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4"><polyline points="20 6 9 17 4 12"></polyline></svg>;

        // =========================================================================
        // FIREBASE CONFIG
        // =========================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDgmejHd4qVbUO_anDPAWXMIyCKQZZ0OlU",
            authDomain: "og-tracker-3c239.firebaseapp.com",
            projectId: "og-tracker-3c239",
            storageBucket: "og-tracker-3c239.firebasestorage.app",
            messagingSenderId: "709565564880",
            appId: "1:709565564880:web:19c2ffa51e89bfbb209bd5"
        };

        let auth, db, firebaseEnabled = false;

        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            firebaseEnabled = true;
        } catch (error) {
            throw new Error("Firebase Initialization Error: " + error.message);
        }

        const DEFAULT_ROUTINE = [
            { id: 'w1', category: 'warmup', name: "Jumping Jacks", reps: "50", sets: 2, type: "reps" },
            { id: 'w2', category: 'warmup', name: "High Knees", reps: "50", sets: 2, type: "reps" },
            { id: 'm1', category: 'main', name: "Push-ups", reps: "15", sets: 3, type: "reps" },
            { id: 'm2', category: 'main', name: "Squats", reps: "20", sets: 3, type: "reps" },
            { id: 'm3', category: 'main', name: "Lunges", reps: "14", sets: 3, type: "reps" },
            { id: 'm4', category: 'main', name: "Plank", reps: "60", sets: 3, type: "timer" },
            { id: 's1', category: 'stretching', name: "Cobra Stretch", reps: "30", sets: 1, type: "timer" }
        ];

        const CATEGORY_STYLES = {
            warmup: { title: "Warm Up", bg: "bg-amber-500/10", text: "text-amber-500", active: "bg-gradient-to-br from-amber-400 to-orange-500 text-white" },
            main: { title: "Main Routine", bg: "bg-indigo-500/10", text: "text-indigo-500", active: "bg-gradient-to-br from-indigo-500 to-purple-600 text-white" },
            stretching: { title: "Cool Down", bg: "bg-emerald-500/10", text: "text-emerald-500", active: "bg-gradient-to-br from-emerald-400 to-teal-500 text-white" }
        };

        const AuthScreen = ({ isDark }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError(""); setLoading(true);
                try {
                    if (isLogin) await auth.signInWithEmailAndPassword(email, password);
                    else await auth.createUserWithEmailAndPassword(email, password);
                } catch (err) {
                    if (err.code === 'auth/unauthorized-domain') {
                        setError(`VERCEL BLOCK: You MUST add "${window.location.hostname}" to Firebase Console -> Authentication -> Settings -> Authorized Domains.`);
                    } else if (err.code === 'auth/operation-not-allowed') {
                        setError("FIREBASE SETUP ERROR: Turn on 'Email/Password' in Firebase Console (Authentication > Sign-in method tab).");
                    } else {
                        setError(err.message.replace("Firebase: ", ""));
                    }
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className={`min-h-screen flex items-center justify-center p-6 ${isDark ? 'bg-[#0f172a] text-white' : 'bg-slate-50 text-slate-900'}`}>
                    <div className="w-full max-w-sm">
                        <div className="text-center mb-10">
                            <div className="inline-block bg-gradient-to-br from-indigo-500 to-purple-600 p-4 rounded-[2rem] text-white mb-6"><IconStar size={40} /></div>
                            <h1 className="text-4xl font-black uppercase italic tracking-tighter">OG Tracker</h1>
                        </div>
                        <form onSubmit={handleSubmit} className={`p-8 rounded-[2.5rem] border shadow-2xl ${isDark ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>
                            <h2 className="text-2xl font-black mb-6">{isLogin ? 'Welcome Back' : 'Create Account'}</h2>
                            {error && <div className="mb-6 p-4 rounded-2xl bg-rose-500/10 border border-rose-500/20 text-rose-500 text-xs font-bold">{error}</div>}
                            <div className="space-y-4">
                                <div>
                                    <label className="text-[10px] font-black uppercase text-slate-400 mb-2 block">Email</label>
                                    <div className={`flex items-center gap-3 p-4 rounded-2xl border ${isDark ? 'bg-slate-950 border-slate-800' : 'bg-slate-50 border-slate-200'}`}>
                                        <IconMail size={18} />
                                        <input type="email" value={email} onChange={e => setEmail(e.target.value)} required className="w-full bg-transparent font-bold outline-none" />
                                    </div>
                                </div>
                                <div>
                                    <label className="text-[10px] font-black uppercase text-slate-400 mb-2 block">Password</label>
                                    <div className={`flex items-center gap-3 p-4 rounded-2xl border ${isDark ? 'bg-slate-950 border-slate-800' : 'bg-slate-50 border-slate-200'}`}>
                                        <IconLock size={18} />
                                        <input type="password" value={password} onChange={e => setPassword(e.target.value)} required className="w-full bg-transparent font-bold outline-none" />
                                    </div>
                                </div>
                            </div>
                            <button type="submit" disabled={loading} className="w-full mt-8 py-4 rounded-2xl bg-indigo-600 text-white font-black shadow-lg disabled:opacity-50">
                                {loading ? 'Processing...' : (isLogin ? 'LOGIN' : 'SIGN UP')}
                            </button>
                            <button type="button" onClick={() => { setIsLogin(!isLogin); setError(""); }} className="w-full mt-6 text-xs font-bold text-slate-400 uppercase tracking-widest hover:text-indigo-400">
                                {isLogin ? "Need an account? Sign up" : "Already have an account? Log in"}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [isDark, setIsDark] = useState(true);
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [user, setUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);
            const [logs, setLogs] = useState({});

            useEffect(() => {
                if (isDark) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [isDark]);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(u => { setUser(u); setAuthLoading(false); });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                let unsubLogs = () => {};
                if (user) {
                    const logsRef = db.collection("artifacts").doc("og-tracker").collection("users").doc(user.uid).collection("logs").doc(selectedDate);
                    unsubLogs = logsRef.onSnapshot(snap => setLogs(snap.exists ? snap.data() : {}));
                }
                return () => unsubLogs();
            }, [selectedDate, user]);

            const toggleSet = async (exId, setIdx) => {
                const exLogs = logs[exId] || [];
                const newExLogs = [...exLogs];
                newExLogs[setIdx] = !newExLogs[setIdx];
                const newLogs = { ...logs, [exId]: newExLogs };
                setLogs(newLogs); 
                if (user) {
                    const logsRef = db.collection("artifacts").doc("og-tracker").collection("users").doc(user.uid).collection("logs").doc(selectedDate);
                    await logsRef.set(newLogs, { merge: true });
                }
            };

            const changeDate = (days) => {
                const d = new Date(selectedDate); d.setDate(d.getDate() + days);
                setSelectedDate(d.toISOString().split('T')[0]);
            };

            const isToday = selectedDate === new Date().toISOString().split('T')[0];

            if (authLoading) return <div className={`min-h-screen flex items-center justify-center ${isDark ? 'bg-[#0f172a]' : 'bg-slate-50'}`}><div className="w-10 h-10 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div></div>;
            if (!user) return <AuthScreen isDark={isDark} />;

            return (
                <div className={`min-h-screen ${isDark ? 'bg-[#0f172a] text-white' : 'bg-slate-50 text-slate-900'} pb-28`}>
                    <nav className={`fixed top-0 left-0 right-0 z-50 glass-panel border-b ${isDark ? 'bg-[#0f172a]/80 border-slate-800' : 'bg-white/80 border-slate-200'} px-5 py-4 flex justify-between items-center`}>
                        <div className="flex items-center gap-2">
                            <div className="bg-gradient-to-br from-indigo-500 to-purple-600 p-1.5 rounded-xl text-white"><IconStar size={20} /></div>
                            <h1 className="font-black text-xl tracking-tighter uppercase italic">OG Tracker</h1>
                        </div>
                        <div className="flex items-center gap-2">
                            <button onClick={() => auth.signOut()} className="p-2.5 rounded-full bg-slate-800 text-rose-400"><IconLogOut size={18} /></button>
                            <button onClick={() => setIsDark(!isDark)} className="p-2.5 rounded-full bg-slate-800 text-yellow-400">
                                {isDark ? <IconSun size={18} /> : <IconMoon size={18} />}
                            </button>
                        </div>
                    </nav>

                    <main className="max-w-md mx-auto px-4 pt-24 pb-10">
                        <div className={`mb-8 p-6 rounded-[2rem] shadow-2xl relative overflow-hidden ${isToday ? 'bg-indigo-600 text-white' : (isDark ? 'bg-slate-800 text-white' : 'bg-white border-2 border-slate-200 text-slate-900')}`}>
                            <div className="relative z-10 flex justify-between items-center">
                                <div>
                                    <p className={`text-[10px] font-black uppercase tracking-widest mb-1 ${isToday ? 'text-indigo-200' : 'text-slate-400'}`}>Target Date</p>
                                    <h2 className="text-3xl font-black tracking-tight">{isToday ? 'TODAY' : selectedDate}</h2>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => changeDate(-1)} className={`p-3 rounded-2xl ${isToday ? 'bg-white/20' : (isDark ? 'bg-slate-700' : 'bg-slate-100')}`}><IconChevronLeft size={20} /></button>
                                    <button onClick={() => changeDate(1)} className={`p-3 rounded-2xl ${isToday ? 'bg-white/20' : (isDark ? 'bg-slate-700' : 'bg-slate-100')}`}><IconChevronRight size={20} /></button>
                                </div>
                            </div>
                        </div>

                        {['warmup', 'main', 'stretching'].map(cat => {
                            const exercises = DEFAULT_ROUTINE.filter(e => e.category === cat);
                            const style = CATEGORY_STYLES[cat];

                            return (
                                <div key={cat} className="mb-8">
                                    <div className="flex items-center gap-3 mb-4 px-2">
                                        <h3 className={`font-black text-xl tracking-tight uppercase ${isDark ? 'text-white' : 'text-slate-900'}`}>{style.title}</h3>
                                    </div>
                                    <div className="space-y-3">
                                        {exercises.map(ex => {
                                            const exLogs = logs[ex.id] || [];
                                            return (
                                                <div key={ex.id} className={`p-5 rounded-3xl border-2 ${isDark ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-100'}`}>
                                                    <div className="flex justify-between items-center mb-4">
                                                        <div>
                                                            <h4 className="font-bold text-lg leading-none mb-1">{ex.name}</h4>
                                                            <p className="text-xs font-bold uppercase text-slate-400">{ex.reps} {ex.type === 'timer' ? 'Secs' : 'Reps'}</p>
                                                        </div>
                                                    </div>
                                                    <div className="flex flex-wrap gap-2">
                                                        {[...Array(parseInt(ex.sets))].map((_, i) => (
                                                            <button key={i} onClick={() => toggleSet(ex.id, i)} className={`flex-1 min-w-[60px] h-12 rounded-2xl border-2 font-black text-xs flex justify-center items-center transition-all active:scale-90 ${exLogs[i] ? style.active : (isDark ? 'bg-slate-800 border-slate-700 text-slate-400' : 'bg-slate-50 border-slate-200 text-slate-500')}`}>
                                                                {exLogs[i] ? <IconCheck size={16} /> : `SET ${i + 1}`}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
